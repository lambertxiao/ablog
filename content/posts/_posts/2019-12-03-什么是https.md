---
layout: post
title: "什么是https"
date: 2019-12-03
tags: [Https, Http, Network]
comments: false
---

# 什么是https

首先, 在讲我们为什么需要https之前, 先看看以下两个流程, 描述了A和B之间想要互相通信, 又想让通信的内容安全

### 流程1

1. A将对称秘钥发送给B

2. B使用该秘钥加密数据, 并发送给A

3. A用秘钥解开B发送的内容, AB成功通信

缺陷: 当中间人C截获了首次通信时, A发送给B的秘钥, 则AB后续所有的交互信息都能被C解开

### 流程2

1. A将自己的公钥给B

2. B收到A的公钥后, 用A的公钥加密了 **B自己生成对称秘钥**, 并将加密后的内容回给了B

3. 当A收到来自B的回复, A用自己的私钥解开了B的加密内容, 从而得到了B的对称秘钥, 后续通信使用该对称秘钥加密内容

缺陷: 

中间人C可在截获了A和B的首次通信后, 用自己的公钥给了B, B收到请求后,他不知道公钥是C发过来的,从而用了C的公钥加密了对称秘钥并回给了C,
C拿到内容后,用自己的私钥解开内容,从而拿到了B的对称秘钥

这个流程的缺陷主要是A和B都无法确定收到的数据是来源与对方的, 而不是来源于中间人的.

## 引入证书

内容:

* 证书颁发机构

* 服务端网址

* 机构私钥加密(服务端公钥)

* 机构私钥加密(证书签名)

### 流程3

**此时假设A作为服务端**

1. A把自己的公钥给证书颁发机构

2. 机构也有自己的一对公钥私钥, 机构用私钥加密 **A的公钥**, 并通过服务端网址等信息生成了一个证书签名,证书签名同样经过
    机构的私钥加密.证书制作完成后把证书发给服务端的A

3. 这时当A想和B通信时,A不再将自己的公钥给B, 而是将证书给B

4. B收到证书之后, 首先要辨别真伪

    由于证书是机构签发的, 各大浏览器和操作系统都维护了所有权威证书机构的名称和公钥,所以B只要知道是哪个机构颁发的证书,就可以找到对应的公钥,
    解开证书得到证书签名

5. B利用CA的公钥解密数字签名，得到服务器信息的摘要，和原本的信息，再对原本的信息hash，和摘要对比来进行校验

6. B此时成功的拿到了来自于A的公钥,后续通信同流程2

流程3的关键在与, 引入了第三方权威机构, 从而让B确定自己收到的证书是来自于A的, 而不是中间人C伪造的.

如果C在一开始劫持了证书为怎么样?

* C替换为自己的证书

    当B收到后,B会验证证书不通过

* C将证书再发给B, B回了信息后, 由于C无法没有A的私钥,即使收到了B的回复之后,也无法解开

以上流程就是https的主体思想, https在http协议的基础上增加了ssl安全层, 以上所有的一系列认证流程都是在ssl中完成的


